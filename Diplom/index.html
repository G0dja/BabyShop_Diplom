<!DOCTYPE html> <!-- –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —á—Ç–æ —ç—Ç–æ HTML 5 -->
<html lang="ua"> <!-- –Ω–∞—á–∞–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —á—Ç–æ —è–∑—ã–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–∫—Ä–∞–∏–Ω—Å–∫–∏–π -->
<head> <!-- –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —á—Ç–æ —ç—Ç–æ –≥–æ–ª–æ–≤–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <meta charset="UTF-8"> <!-- –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∫—É UTF-8 -->
  <title>–ì–æ–ª–æ–≤–Ω–∞</title> <!-- –Ω–∞–∑–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
  <link rel="stylesheet" href="default.css"> <!-- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ü—Å—Å —Ñ–∞–π–ª–∞ -->
  <link rel="stylesheet" href="core.css"> <!-- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ü—Å—Å —Ñ–∞–π–ª–∞ -->
  <link rel="stylesheet" href="items-view.css"> <!-- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ü—Å—Å —Ñ–∞–π–ª–∞ -->
</head>
<body> <!-- –æ–±–æ–∑–Ω–∞—á–µ–Ω–∏–µ —á—Ç–æ —ç—Ç–æ —Ç–µ–ª–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->

  <header class="page-section"> <!-- —Ö–µ–¥–µ—Ä-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="logo header-item"> <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ª–æ–≥–æ—Ç–∏–ø–∞ -->
      <img src="" alt="–ª–æ–≥–æ—Ç–∏–ø"> <!-- –∫–∞—Ä—Ç–∏–Ω–∫–∞ –ª–æ–≥–æ—Ç–∏–ø–∞ -->
    </div>

    <div class="search-bar header-item"> <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ –ø–æ–∏—Å–∫–∞ -->
      <form class="not-form"> <!-- —Ñ–æ—Ä–º–∞ -->
        <input id="search" type="text" name="search" placeholder="–ø–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É" required> <!-- –≤–≤–æ–¥—á–∏–∫ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é -->
        <button type="submit">–ø–æ—à—É–∫</button> <!-- –∫–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ -->
      </form>
    </div>

    <div class="account-tools header-item"> <!-- –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–∞ -->
      <a href="account" class="account-link">–∞–∫–∫–∞—É–Ω—Ç</a> <!-- —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–∫–∫–∞—É–Ω—Ç–∞ -->
      <a href="cart" class="shopping-cart-link">–∫–æ—à–∏–∫</a> <!-- —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—ã–±—Ä–∞–Ω—ã—Ö –∫ –ø–æ–∫—É–ø–∫–µ —Ç–æ–≤–∞—Ä–æ–≤ -->
    </div>
  </header>

  <main>
    <div class="shopping-tools page-section">
      <div class="categories">
        –∫–∞—Ç–µ–≥–æ—Ä—ñ—è
      </div>
  
      <div class="sorting">
        <div class="sorting-type">
          <label for="sorting-type-select">–°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –∑–∞</label>
          <select id="sorting-type-select">
            <option disabled selected value="defaul">–±–µ–∑ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è</option>
            <option value="price">—Ü—ñ–Ω–æ—é</option>
            <option value="rating">—Ä–µ–π—Ç–∏–Ω–≥–æ–º</option>
          </select>
        </div>
  
        <div class="sorting-direktion sort-up">
          <p class="up">‚Üë</p>
          <p class="down">‚Üì</p>
        </div>
      </div>
    </div>
    
    <hr>
  
    <div id="items-list" class="items-list page-section">

    </div>
  </main>

  <footer class="page-section">
    <p>–†–æ–∑—Ä–æ–±–Ω–∏–∫: —Ö—Ç–æ —Ç–æ —Ç–∞–º</p>
  </footer>

  <script>
    const searchInput = document.querySelector('input#search'),
          searchRequest = new URL(location.href).searchParams.get('search')
    if(searchRequest) searchInput.value = searchRequest
  </script>
  <script src="itemsSorting.js"></script>
  <script>

    const shoppingItemsNode = document.querySelector('#items-list')

    function shoppingItemToHTMLElement(itemObj, itemId) {
      const card = document.createElement('div')
      card.classList.add('item-card')
      card.dataset.itemId = itemId

      let ratingString = ''

      for(let i = 0; i < 5; i++) {
        if(i < +itemObj.rating) ratingString += '‚òÖ'
        else ratingString += '‚òÜ'
      }

      ratingString += ' (' + itemObj.reviews.length + ' –≤—ñ–¥–≥—É–∫'

      const reviewsLastNumber = itemObj.reviews.length % 10,
            reviewsLastTwoNumbers = itemObj.reviews.length % 100

      if(reviewsLastNumber === 0 || (4 < reviewsLastNumber && reviewsLastNumber < 10) || (10 <= reviewsLastTwoNumbers && reviewsLastTwoNumbers <= 20)) ratingString += '—ñ–≤'
      else if(1 < reviewsLastNumber && reviewsLastNumber < 5) ratingString += '–∞'

      ratingString += ')'

      card.innerHTML = `
        <div class="img div-image" style="background-image: url(${itemObj.images[0]})"></div>
        <div class="description">
          <a class="title" href="/item-page?id=${itemId}">${itemObj.title}</a>
          <div class="raiting">${ratingString}</div>
          <div class="price-container">
            <p class="price">${itemObj.price} ‚Ç¥</p>
            <div class="icons-container">
              <div class="add-to-like shopping-buttons">‚ô•</div>
              <div class="add-to-buy shopping-buttons" data-buy-item-id="${itemId}">üõí</div>
            </div>
          </div>
        </div>
      `

      return card
    }

    fetch('/shopping_items.json')
    .then(response => response.text())
    .then(data => {
      const shoppingItems = JSON.parse(data)

      for(const key in shoppingItems.items) {
        shoppingItemsNode.insertAdjacentElement('beforeEnd', shoppingItemToHTMLElement(shoppingItems.items[key], key))
      }

      mainScritp()
    })

    function mainScritp() {

      sortItemsScript()

      if(searchRequest) {
        const items = Array.from(shoppingItemsNode.querySelectorAll('.item-card'))

        items.sort((a, b) => {
          const titleA = a.querySelector('.description a.title').innerText,
                titleB = b.querySelector('.description a.title').innerText

          const aDistance = levenshteinDistance(searchRequest, titleA),
                bDistance = levenshteinDistance(searchRequest, titleB)
          
          return aDistance - bDistance
        })

        shoppingItemsNode.innerHTML = ''
        items.forEach(itm => shoppingItemsNode.appendChild(itm))
      }
    }

  function levenshteinDistance(a, b) {
    if(a.length === 0) return b.length
    if(b.length === 0) return a.length

    const matrix = Array(a.length + 1).fill(null).map(() => Array(b.length + 1).fill(null))

    for(let i = 0; i <= b.length; i++) matrix[0][i] = i
    for(let j = 0; j <= a.length; j++) matrix[j][0] = j

    for(let j = 1; j <= b.length; j++) {
      for (let i = 1; i <= a.length; i++) {
        const indicator = a[i - 1] === b[j - 1] ? 0 : 1
        matrix[i][j] = Math.min(
          matrix[i - 1][j] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j - 1] + indicator,
        )
      }
    }

    return matrix[a.length][b.length]
  }

  </script>

  <script src="add_item_to_cart.js"></script>
</body>
</html>